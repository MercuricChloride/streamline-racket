(def/alias TELLER_ADDRESS (address "0x00182fdb0b880ee24d428e3cc39383717677c37e"))
(def/alias REGISTRY_ADDRESS (address "0x00182fdb0b880ee24d428e3cc39383717677c37e"))

(def/sol ERC721 "./interfaces/ERC721.sol")
(def/sol TELLER "./interfaces/ITellerV2.sol")
(def/sol REGISTRY "./interfaces/IMarketRegistry.sol")

(helpers/map_events `("teller" (TELLER_ADDRESS TELLER) "registry" (REGISTRY_ADDRESS REGISTRY)))

(def/mfn submitted_bids
    (map-events)
  (chain (e map_events)
         (lambda (events) (get-in e ["teller" "SubmittedBid"])) ; Get the submitted bids events stored in map-events.teller.SubmittedBid

         (map (lambda (event) (rpc/call (get-in TELLER ["getBidState"]) ; fn we are calling
                                        TELLER_ADDRESS ; address for the call
                                        ([uint (get-in event ["bidId"])]) ; a list of tuples containing (type value)
                                        )))))

;; (def/mfn accepted-bids
;;     (map-events)
;;   (chain (e map-events)

;;          (lambda (events) (get-in ("teller" "AcceptedBid")))

;;          (map (lambda (event) (rpc/call)) e)))
